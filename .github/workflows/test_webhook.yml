name: Webhook test
on:
  repository_dispatch:
    types: [ new_ipex_installer ]
  
jobs:
  scans:
    runs-on: [ self-hosted ]
    steps:
      - name: Extract context information
        run: echo "${{ toJSON(github) }}" 1>/dev/null
  
  workload-tests:   
    runs-on: [ self-hosted ]
    steps:
      -  name: Workload tests
         run: echo "Workload tests succeeded"
      
  mz-drop:
    if: ${{ always() && needs.scans.result=='success' && needs.workload-tests.result=='success' }}
    runs-on: [ self-hosted ]
    needs: [scans, workload-tests]
    steps: 
      - name: Model Zoo dummy drop
        run: echo "New drop for Model Zoo deployed!!!"
      - name: Notify AI Tool Bundle repository of new IMZ drop
        run: |
          curl --request POST \
          --url https://api.github.com/repos/intel-innersource/frameworks.ai.platform.development/dispatches \
          --header "Authorization: token ${{ secrets.AI_TOOL_WEBHOOK_TOKEN }}" \
          --header 'Accept: application/vnd.github.everest-preview+json' \
          --data '{"event_type": "imz_drop_succeeded", "client_payload": { "repository": "'"$GITHUB_REPOSITORY"'" }}'
